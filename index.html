<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Internal ERP</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font-family: system-ui, -apple-system, sans-serif; background:#f6f7fb; margin:0; }
  .wrap { max-width:1200px; margin:auto; padding:20px; }
  h1 { margin:0 0 6px }
  .tabs button {
    border:1px solid #ddd; background:#fff; padding:8px 14px;
    border-radius:18px; margin-right:6px; cursor:pointer;
  }
  .tabs button.active { background:#2563eb; color:#fff; border-color:#2563eb }
  .card {
    background:#fff; border-radius:14px; padding:18px; margin-top:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.06);
  }
  .grid { display:grid; grid-template-columns:repeat(4,1fr); gap:12px }
  .grid-2 { grid-template-columns:repeat(2,1fr) }
  label { font-size:12px; color:#555 }
  input, select, textarea {
    width:100%; padding:10px; border-radius:10px;
    border:1px solid #ddd; font-size:14px;
  }
  textarea { resize:none }
  .btn {
    padding:10px 14px; border-radius:12px;
    border:0; cursor:pointer; font-weight:600;
  }
  .btn-primary { background:#2563eb; color:#fff }
  .btn-gray { background:#eee }
  table { width:100%; border-collapse:collapse; margin-top:10px }
  th, td { padding:8px; border-bottom:1px solid #eee; text-align:left }
  th { font-size:12px; color:#555 }
  .right { text-align:right }
</style>
</head>

<body>
<div class="wrap">
  <h1>Internal ERP</h1>
  <div class="tabs">
    <button class="active" onclick="showTab('inventory')">Inventory IN</button>
    <button onclick="showTab('sales')">Sales</button>
  </div>

  <!-- INVENTORY IN -->
  <div id="inventory" class="card">
    <h3>Inventory IN</h3>
    <div class="grid">
      <div>
        <label>Date</label>
        <input type="date" id="inv_date" />
      </div>
      <div>
        <label>FX RMB → USD</label>
        <input type="number" id="inv_fx" value="7.00" step="0.01" />
      </div>
      <div>
        <label>SKU</label>
        <input id="inv_sku" />
      </div>
      <div>
        <label>Warehouse</label>
        <select id="inv_wh"></select>
      </div>

      <div>
        <label>Product category</label>
        <input list="prodCats" id="inv_cat" />
      </div>
      <div>
        <label>Size</label>
        <input list="prodSizes" id="inv_size" />
      </div>
      <div>
        <label>Color</label>
        <input list="prodColors" id="inv_color" />
      </div>
      <div>
        <label>Qty</label>
        <input type="number" id="inv_qty" />
      </div>

      <div>
        <label>Unit RMB</label>
        <input type="number" id="inv_rmb" step="0.01" />
      </div>
      <div>
        <label>Unit USD</label>
        <input id="inv_usd" disabled />
      </div>
      <div>
        <label>Total USD</label>
        <input id="inv_total" disabled />
      </div>
      <div>
        <label>Note</label>
        <input id="inv_note" />
      </div>
    </div>

    <br/>
    <button class="btn btn-primary" onclick="saveInventory()">Save Inventory IN</button>
  </div>

  <!-- SALES -->
  <div id="sales" class="card" style="display:none">
    <h3>Sales Order</h3>

    <div class="grid">
      <div><label>Date</label><input type="date" id="so_date"></div>
      <div><label>Customer</label><input id="so_customer"></div>
      <div><label>Phone</label><input id="so_phone"></div>
      <div><label>Address</label><input id="so_address"></div>
      <div>
        <label>Delivery company</label>
        <select id="so_delivery"></select>
      </div>
    </div>

    <h4>Items</h4>
    <table id="items">
      <thead>
        <tr>
          <th>SKU</th><th>Category</th><th>Qty</th>
          <th>Price</th><th>Currency</th><th>Total</th><th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button class="btn btn-gray" onclick="addItem()">+ Add item</button>

    <h4>Payment (anytime)</h4>
    <div class="grid grid-2">
      <div>
        <label>Amount received</label>
        <input type="number" id="pay_amount">
      </div>
      <div>
        <label>Currency</label>
        <select id="pay_currency">
          <option>USD</option>
          <option>KHR</option>
        </select>
      </div>
      <div>
        <label>FX (if KHR)</label>
        <input type="number" id="pay_fx" step="0.01">
      </div>
      <div>
        <label>Received by</label>
        <input id="pay_by">
      </div>
    </div>

    <br/>
    <button class="btn btn-primary" onclick="saveSales()">Save Sales Order</button>
  </div>
</div>

<!-- LISTS -->
<datalist id="prodCats"></datalist>
<datalist id="prodSizes"></datalist>
<datalist id="prodColors"></datalist>

<script>
const API = "https://script.google.com/macros/s/AKfycbzgC6AqVVftlcvoetDa2aTVzdSbrK7FSJt7kpJCFDeHB7o7azG0Lh_yB4a4CBw1I-ML/exec";

function showTab(t){
  inventory.style.display = t==="inventory"?"block":"none";
  sales.style.display = t==="sales"?"block":"none";
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
}

async function loadLists(){
  const r = await fetch(API+"?action=lists");
  const j = await r.json();
  const d = j.data;

  inv_wh.innerHTML = d.locations.map(x=>`<option>${x}</option>`).join("");
  so_delivery.innerHTML = ["","Grab","J&T","Virak Buntham","In-house"]
    .map(x=>`<option>${x}</option>`).join("");

  prodCats.innerHTML = d.prodCats.map(x=>`<option value="${x}">`).join("");
  prodSizes.innerHTML = d.prodSizes.map(x=>`<option value="${x}">`).join("");
  prodColors.innerHTML = d.prodColors.map(x=>`<option value="${x}">`).join("");
}
loadLists();

function addItem(){
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td><input></td>
    <td><input list="prodCats"></td>
    <td><input type="number" value="1"></td>
    <td><input type="number" step="0.01"></td>
    <td>
      <select><option>USD</option><option>KHR</option></select>
    </td>
    <td class="right">0.00</td>
    <td><button onclick="this.closest('tr').remove()">✕</button></td>`;
  items.querySelector("tbody").appendChild(tr);
}
addItem();
</script>
</body>
</html>
