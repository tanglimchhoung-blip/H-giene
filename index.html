<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Internal ERP</title>

<style>
body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto; margin:0; background:#f7f8fa;}
header{background:#fff;padding:16px 20px;border-bottom:1px solid #e5e7eb;}
h1{margin:0;font-size:20px;}
nav{display:flex;gap:10px;margin-top:10px;}
nav button{border:1px solid #e5e7eb;background:#fff;padding:8px 14px;border-radius:8px;cursor:pointer}
nav button.active{background:#111;color:#fff}
main{padding:20px;max-width:1100px;margin:auto}
.card{background:#fff;border-radius:12px;padding:16px;margin-bottom:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
input,select,button{padding:10px;border-radius:8px;border:1px solid #d1d5db;width:100%}
button.primary{background:#111;color:#fff;border:none}
.hidden{display:none}
small{color:#6b7280}
</style>
</head>

<body>

<header>
  <h1>Internal ERP</h1>
  <small>Stable Â· Lists are read-only (Google Sheet â†’ Lists)</small>
  <nav>
    <button onclick="showTab('inv')" class="active">Inventory IN</button>
    <button onclick="showTab('sales')">Sales</button>
    <button onclick="showTab('exp')">Expenses</button>
  </nav>
</header>

<main>

<!-- INVENTORY -->
<div id="inv" class="card">
<h3>Inventory IN</h3>
<div class="grid">
<input id="inv_date" type="date">
<select id="inv_loc"></select>
<select id="inv_cat"></select>
<input id="inv_product" placeholder="Product name">
<select id="inv_color"></select>
<select id="inv_size"></select>
<input id="inv_qty" type="number" placeholder="Qty">
<input id="inv_rmb" type="number" placeholder="Unit RMB">
<input id="inv_fx" type="number" value="7.2">
<input id="inv_usd" placeholder="Unit USD" disabled>
<input id="inv_amt" placeholder="Amount USD" disabled>
<input id="inv_note" placeholder="Note">
</div>
<br>
<button class="primary" onclick="saveInventory()">Save Inventory IN</button>
</div>

<!-- SALES -->
<div id="sales" class="card hidden">
<h3>Sales</h3>
<div class="grid">
<input id="so_date" type="date">
<select id="so_loc"></select>
<input id="so_customer" placeholder="Customer">
<select id="so_delivery"></select>
<select id="so_cat"></select>
<input id="so_product" placeholder="Product">
<select id="so_color"></select>
<select id="so_size"></select>
<input id="so_qty" type="number" placeholder="Qty">
<input id="so_price" type="number" placeholder="Unit Price">
<input id="so_paid" type="number" placeholder="Paid Amount">
</div>
<br>
<button class="primary" onclick="saveSale()">Save Sale</button>
</div>

<!-- EXPENSE -->
<div id="exp" class="card hidden">
<h3>Expenses</h3>
<div class="grid">
<input id="ex_date" type="date">
<select id="ex_loc"></select>
<select id="ex_cat"></select>
<input id="ex_amt" type="number" placeholder="Amount">
<input id="ex_note" placeholder="Note">
</div>
<br>
<button class="primary" onclick="saveExpense()">Save Expense</button>
</div>

</main>

<script>
/* ðŸ”’ API LOCKED HERE */
const API = "https://script.google.com/macros/s/AKfycbxyUciIkMbsDGNMHTj3ScMwkqzajMHnEnFLdURq9DCudRQ_RBPNErogZcqQUDZwlZyP/exec";

/* ---------- helpers ---------- */
function qs(id){return document.getElementById(id)}
function fill(sel,arr){
  sel.innerHTML="<option value=''>â€”</option>";
  arr.forEach(v=>{
    const o=document.createElement("option");
    o.textContent=v;o.value=v;sel.appendChild(o)
  })
}
async function api(action,data){
  const r=await fetch(API,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action,...data})});
  return r.json()
}

/* ---------- init ---------- */
(async ()=>{
  const r=await fetch(API+"?action=get_lists");
  const j=await r.json();
  const L=j.data;

  fill(qs("inv_loc"),L.LOCATION);
  fill(qs("inv_cat"),L.PROD_CAT);
  fill(qs("inv_color"),L.PROD_COLOR);
  fill(qs("inv_size"),L.PROD_SIZE);

  fill(qs("so_loc"),L.LOCATION);
  fill(qs("so_cat"),L.PROD_CAT);
  fill(qs("so_color"),L.PROD_COLOR);
  fill(qs("so_size"),L.PROD_SIZE);
  fill(qs("so_delivery"),L.DELIVERY_COMPANY);

  fill(qs("ex_loc"),L.LOCATION);
  fill(qs("ex_cat"),L.EXP_CAT);
})();

/* ---------- tabs ---------- */
function showTab(t){
  ["inv","sales","exp"].forEach(x=>qs(x).classList.add("hidden"));
  qs(t).classList.remove("hidden");
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
}

/* ---------- calc ---------- */
["inv_qty","inv_rmb","inv_fx"].forEach(id=>{
  qs(id).addEventListener("input",()=>{
    const q=+qs("inv_qty").value;
    const r=+qs("inv_rmb").value;
    const fx=+qs("inv_fx").value;
    if(q&&r&&fx){
      const u=(r/fx).toFixed(2);
      qs("inv_usd").value=u;
      qs("inv_amt").value=(u*q).toFixed(2);
    }
  })
})

/* ---------- save ---------- */
async function saveInventory(){
  alert(JSON.stringify(await api("inventory_in",{
    date:qs("inv_date").value,
    location:qs("inv_loc").value,
    prod_cat:qs("inv_cat").value,
    product:qs("inv_product").value,
    color:qs("inv_color").value,
    size:qs("inv_size").value,
    qty:+qs("inv_qty").value,
    unit_rmb:+qs("inv_rmb").value,
    fx:+qs("inv_fx").value,
    note:qs("inv_note").value
  })))
}

async function saveSale(){
  alert(JSON.stringify(await api("sale",{
    date:qs("so_date").value,
    location:qs("so_loc").value,
    customer:qs("so_customer").value,
    delivery_company:qs("so_delivery").value,
    prod_cat:qs("so_cat").value,
    product:qs("so_product").value,
    color:qs("so_color").value,
    size:qs("so_size").value,
    qty:+qs("so_qty").value,
    unit_price:+qs("so_price").value,
    paid:+qs("so_paid").value
  })))
}

async function saveExpense(){
  alert(JSON.stringify(await api("expense",{
    date:qs("ex_date").value,
    location:qs("ex_loc").value,
    category:qs("ex_cat").value,
    amount:+qs("ex_amt").value,
    note:qs("ex_note").value
  })))
}
</script>

</body>
</html>
